---
title: 'Evaluating Effects of Population Demographics on Access to Sexual Health Care:
  A Toronto Case Study'
output:
  pdf_document: default
  html_document: default
authors: "Audreana Rossi, Chantelle Lobo, Eva Boomsma, Heléna Muirhead-Hunt, Eva Novoselac, Samantha Kirtz, Peri Juskiw & Victoria Baginski"
---
```{r, include=FALSE}
# install.packages("cancensus")
# install.packages("readr")
# install.packages("geojsonsf")
# install.packages("spaa")
# install.packages("tidyverse")
# install.packages("sp")
# install.packages("spatstat")
# install.packages("spdep")
# install.packages("reshape2")

library(cancensus)
library(sf)
library(sp)
library(plotly)
library(readr)
library(geojsonsf)
library(tidyverse)
library(spatstat)
library(dplyr)
library(spdep)
library(spaa)
library(ggplot2)
library(reshape2)
```
# Introduction
  Access to sexual health care services is a critical component of public health initiatives, fostering the welfare of individuals within communities. However, in Toronto, Canada, as in many urban centres worldwide, equitable access to such services remains elusive for certain demographic groups. The City of Toronto promotes its Sexual Health Clinic Program following the Ontario Ministry of Health services guidelines, providing various services to sexually active individuals (City of Toronto, n.d.). According to the City of Toronto’s Sexual Health Clinics website, the Sexual Health Clinic program aims to serve those, regardless of age, experiencing barriers to accessing effective sexual health services, including: people with concerns about a sexually transmitted infection and their partners, recent immigrants or refugees, people who share a disproportionate burden of HIV/STIs, people who need access to low cost birth control, people who are part of the 2SLGBTQ community, and people involved in sex work. It is important for the city to recognize these marginalised groups, but also to adequately serve the communities. Accessibility to sexual healthcare in Toronto should therefore reflect efforts to accommodate these vulnerable groups.
  This project aims to identify marginalised groups in Toronto and the areas they are most concentrated, and examine if there is a correlation between these areas and accessibility to sexual health clinics. Our research will answer the question “How does accessibility to sexual health care clinics differ across social demographics in Toronto?” To do this, both the demographics (population, median income, population of single parents, indigenous population, and visible minorities) and statistics are mapped using RStudio and its packages, allowing the comparison of spatial demographic distribution and clinic accessibility. The project will explore whether unequal access to services such as sexual healthcare is related to disadvantaged demographics in
Toronto, in hopes of rendering these results to provide feedback and awareness to where there are shortcomings in the health clinics of Toronto for these demographics. Presenting both census and clinical data will be used to examine these issues. In the end, eliminating any identified differences in accessibility to sexual health care is crucial to advancing equity in health care and enhancing health outcomes for all Torontonians.

# Background
  Access to sexual health care services is a fundamental part of public health and promotes the well-being of people in Toronto, Canada. However, accessibility to these services is not fully uniform across various traditional demographics (such as gender, age, income, education, marital status etc.), and social demographics (like sexual orientation, queer identity, culture, religion etc.). Understanding these barriers for marginalised groups is crucial for ensuring equitable access to sexual health services for all individuals (Salehi et al., 2014). Toronto’s population is large at about 3,025,647, and diverse, providing a complete and complex landscape for this study.
  Previous work has explored patterns of inequality between demographics and sexual health, and the importance of addressing these gaps to care. Pui-Hing Wong et al. (2012) found young women of lower income and racial minorities to have poorer sexual health, suggesting a lack of access to such service in areas of low income. Young, socioeconomically vulnerable females are also more likely to use sexual health services if they are near their home (Olsen et. al, 2012). This emphasises the need for sexual health clinics located in lower income and racially marginalised neighbourhoods. Weiner supported this in Studies in Family Planning (2010) by discussing how limited resources for sexual and reproductive health services often lead to unequal access, especially for vulnerable groups.
  Another recent study focused on the access to these sexual clinics based on travel time; they found that accessibility decreases by census tracts of higher average age, and individuals who identified as immigrants, visible minorities, or unemployed (Wang et al., 2022). Accessibility increases for census tracts of higher income and education, renters, and higher proportions of male, single, or Aboriginal individuals. Overall, the research suggests there are many areas in need of new sexual health clinics to support marginalised individuals; understanding the demographic trends impacting access to sexual health care will help inform which areas are most in need.
  Similar demographic disparities in access to sexual health clinics have been documented outside of Toronto in multiple global and international case studies, contributing to the issue of unequal access of sexual health care (Shah & Wilson, 2016; Olsen et al., 2012). Despite this, the majority of the literature explores demographic effects on accessing general health care, as opposed to specifically exploring access to sexual health care. Additionally, any research like that of Wang et al. (2022) focusing especially on sexual health care, is out of date, and reflects a pre-pandemic picture of access to care that may be drastically different today. These gaps in research highlight the necessity of our project in investigating how demographic factors affect Torontonians access to sexual health care today.
  As outlined, there is a great need for research in access to as well as the development of sexual health care internationally, but especially in urban centres and at a neighbourhood level (Shah et al., 2016). It is important to assess this issue using region-specific strategies, as healthcare is not a “one size fits all” service (Weiner, 2010).
  
# Data & Methods
  The area selected for this project was the census subdivision (CSD) of Toronto. The primary data being used in our analysis includes the point data of fifteen sexual health clinic locations in Toronto, as well as spatial demographic and social demographic data at the dissemination area level (Figure 1).
  Before analysis in the R Studio software, both the Toronto sexual health clinic data (Toronto Public Health, 2024) and the Canadian census data (Statistics Canada, 2021) had to be prepared for use. Additionally, a shapefile of Toronto was extracted for calculated accessibility to clinics to be mapped onto (Statistics Canada, 2021).
```{r, include=FALSE}
# Load in clinic & DA files, change directory:
clinics <- read_sf("C:\\Users\\evacb\\Downloads\\Paez_Group3_Proj\\clinicsUTM\\clinicsUTM.shp") #From open database Toronto, locations geocoded on Google sheets
DAs <- read_sf("C:\\Users\\evacb\\Downloads\\Paez_Group3_Proj\\TorontoDAs\\TorontoDAs.shp") 
Toronto <- read_sf("C:\\Users\\evacb\\Downloads\\Paez_Group3_Proj\\Toronto\\Toronto.shp") #shapefile from merging all DAs. This wasn't used, but is good to have for reference.

#Set up origin data (DA centroids) -- we used st_distance so did not have to convert to coordinates
centroids <- st_centroid(DAs)
centroidcoords <- st_coordinates(centroids) #converts $geometry field to coordinates
centroidcoords <- as.data.frame(centroidcoords) #convert to dataframe
centroidcoords <- cbind(DAs$DAUID, coordinates) #Combine coordinates with DAUID

#colnames(centroidcoords) <- c("DAUID", "X", "Y") #rename column
```
```{r, echo=FALSE}
#plot for figure 1
ggplot() +
  geom_sf(data = DAs) +
  theme_minimal()
```

## Clinic Data
  The sexual health clinic dataset is from the Toronto Open Data Portal, published by Toronto Public Health. The dataset is from August 15, 2019, with the last refresh being January 14, 2024. The Toronto sexual health clinic data, including fifteen locations operated by Toronto Public Health, was downloaded in .xslx format. This data set only indicated the location of the clinics using addresses, thus coordinates had to be incorporated to the table. Using the ‘Awesome Table’ extension from Google Sheets, the latitude and longitude coordinates were generated in two separate columns using the address as an input. This allowed each location to obtain point geometry and be loaded into RStudio for further analysis.
  
```{r, include=FALSE}
#Set up destination data (clinics)
cliniccoords <- st_coordinates(clinics) #converts lat/lon fields to coordinates
cliniccoords <- as.data.frame(cliniccoords) #convert to dataframe
```
```{r, echo=FALSE}
#show clinic data
ggplot() +
  geom_sf(data = DAs) +
  geom_sf(data = clinics) # This works
```
## Census Data
The census data was accessed through MountainMath Analytics website, which hosted a comprehensive viewer of Statistics Canada data from the 2021 census. The data was chosen to be extracted at the dissemination area (DA) level within the Toronto Census subdivision, within the metropolitan area (CMA) of the Greater Toronto District. Data was selected at the DA level because it was the smallest available census unit, meaning it best represented the census data at a population level.
To load Canadian census data in R Studio it required use of an API key. This key was obtained from the Canadian Census Analyser, hosted by the University of Toronto. The API key was granted through the students’ McMaster login credentials. The cache path was then set, using the ‘set_cancensus_cache_path’ package, linking the census data to this location on the device. The ‘can_census’ function was then utilised in R Studio to extract census data of interest at the DA level:

-Population
-Income
-Gender
-Age
-Visible Minority Population
-Indigenous Population
-Single Parent Population

  Census data by DA was extracted as a simple feature class data frame, and table variables were renamed for ease of use. The census data variables of interest, listed above, were then loaded as columns into the Toronto census data frame from the created cache location. Some variables were manipulated for further use in the analysis, including creating a variable for total proportion of female population in each dissemination area, obtained by dividing the total female population by the total census area population. A variable for the population aged 15 and above was also created by adding the counts of the population aged 15 to 64 and the population 65 and above. This was done because there is increased demand for access to sexual health clinics in this age group, compared to the rest of the population.
```{r, include=FALSE}
# Call API:
# set_cancensus_api_key('CensusMapper_42e31dc15284090eb92c5f1c43b328a1', install = TRUE)
# Define cache path
set_cancensus_cache_path("C:\\Users\\evacb\\Downloads\\Paez_Group3_Proj\\cache", install = TRUE, overwrite=TRUE)
#set api key
set_cancensus_api_key('CensusMapper_42e31dc15284090eb92c5f1c43b328a1', install = TRUE, overwrite=TRUE)
```
``` {r, include=FALSE}
#Return sf class data frames: ->use this website to define what data to pull:https://censusmapper.ca/api/CA21#api_variable
###Full census data names below
# "Income_15over" = Income statistics in 2020 for the population aged 15 years and over in private households = v_CA21_554 
# "LowIncome" = Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%) = v_CA21_1040
# "Female_All_Ages" = Total - Age (female) = v_CA21_10
# "Population_15to64" = Total - Age 15 to 64 (all genders)= v_CA21_68
# "Average_Age" = Average Age (all genders)= v_CA21_386
# "Median total income among recipients ($) = v_CA21_560
# "Visible minority population" = Total visible minority for population in private households = v_CA21_4872
# "Total one-parent families" = Total 1 parent families = v_CA21_507
# "Indigenous population" = Total Indigenous identity for the population in private households = v_CA21_4201
# "Pop65plus" = population 65 and over = v_CA21_251

#load data
census_data <- get_census(dataset='CA21', regions=list(CSD="3520005"), 
                        vectors=c("v_CA21_554", "v_CA21_1040", "v_CA21_10", "v_CA21_68", "v_CA21_386", "v_CA21_560", "v_CA21_4872", "v_CA21_507", "v_CA21_4201", "v_CA21_251"), labels="detailed", level='DA', geo_format = "sf")
```
```{r, include=FALSE}
# Rename GEOUID column
  colnames(census_data)[colnames(census_data) == "GeoUID"] <- "DAUID"
# Rename Income (total over 15) column
  colnames(census_data)[colnames(census_data) == "v_CA21_554: Income statistics in 2020 for the population aged 15 years and over in private households"] <- "Income_15andover"
#Rename Low Income column
  colnames(census_data)[colnames(census_data) == "v_CA21_1040: Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)"] <- "Low_Income"
#Rename Female Age column
  colnames(census_data)[colnames(census_data) == "v_CA21_10: Total - Age"] <- "Female_Population"
#Rename Female Age column
  colnames(census_data)[colnames(census_data) == "v_CA21_68: 15 to 64 years"] <- "Population_15to64"
#Rename Female Age column
  colnames(census_data)[colnames(census_data) == "v_CA21_386: Average age"] <- "Average_Age"
#Rename Median income column
  colnames(census_data)[colnames(census_data) == "v_CA21_560: Median total income in 2020 among recipients ($)"] <- "Median_Income"
#Rename visible minority column
  colnames(census_data)[colnames(census_data) == "v_CA21_4872: Total - Visible minority for the population in private households"] <- "VisibleMinorityPopulation"
#Rename one parent families
  colnames(census_data)[colnames(census_data) == "v_CA21_507: Total one-parent families"] <- "Total_OneParent_Families"
#Rename indigenous pop  
  colnames(census_data)[colnames(census_data) == "v_CA21_4201: Total - Indigenous identity for the population in private households"] <- "Indigenous_population"
#Rename over 65 population
    colnames(census_data)[colnames(census_data) == "v_CA21_251: 65 years and over"] <- "Pop65plus"
```
```{r, include=FALSE}
#Calculate proportion of female population:
census_data$Prop_Female <- census_data$`Female_Population` / census_data$Population
#Create new column of total population 15 and over 
#(by summing populations from 15-64 and 64+)
census_data$Pop15plus <- census_data$Population_15to64 + census_data$Pop65plus
```

## Plotting the Census Data
  Using the ‘ggplot()’ function, the census data of interest was plotted in the study area as choropleth maps, showcasing the different variable values for each dissemination area. These maps allowed for a simplistic visual understanding of the distribution of a variety of population demographics. These were combined for easy side by side comparisons of trends compared to sexual health clinic locations.
  
```{r, echo=FALSE}

```
  
## Creating the Table for Accessibility Analysis
  The centroids of each of these dissemination areas was first determined using the ‘st_centroid’ function, applied to the Toronto shapefile. These points within the study area were created to determine the accessibility score of each census tract area, in later steps. They define the locations or origins of demand for sexual health care, where areas cannot be used.
  The function ‘st_distance’ was then used to calculate the Euclidean distances from each dissemination area centroid to each clinic in a matrix. We then converted it to a binary distance list, with a column for the origin (DAUID), destination (clinic 1-15) and paired distances in metres. To obtain travel time, distances were converted from metres to kilometres by dividing by 1000, and then converted to travel time by dividing by 40. A general travel time of 40 kilometres per hour was assumed, considering the urban study area. Stepwise impedance was calculated using a ‘case_when’ function using methods demonstrated by Paez et al. (2019). Impedance was given in minutes, thus was converted back to minutes by multiplying by 60. The function, courtesy of Paez et al. (2019) is listed below.

![Paez 2019, function](/Users/helenamh/Desktop/Stats_Proj_Group3/Image1_bins.png)
  These impedance values for all DAs to each clinic were then summed, creating the total weighted sum of impedance for each DA. This data frame, including the summed impedance value, was then appended to the census data of interest via ‘left join.’ Similar methodology was performed by Dr. Paez, but with the use of network distance. This allowed for a more realistic view on spatial accessibility, which defined our main point of reference for analysing spatial accessibility to sexual health clinics. These accessibility scores were then mapped for visualisation and analysation purposes, and accessibility score was then used in each of the analyses indicated below. A Moran’s I test and map were used to identify patterns in the data. We also attempt to determine a relationship of statistical significance between the census data and accessibility data using regression analysis.
  
```{r, include=FALSE}
#Euclidean distance method (distance from DA centroid to clinic):
#Creating a matrix for euclidean distance method 
eu_distances <- st_distance(centroids, clinics) 
```
```{r, include=FALSE}
#Creating a binary distance list
origin <- rep(1:3743, each = 15) 
# Create the "origin" column for all 3743 DAs, repeated for every 15 clinics
destination <- rep(1:15, length.out = 3743 * 15) 
# Create the "destination" column for clinic 1-15 for every DA
distance <- as.vector(t(eu_distances)) 
# Create the "distance" column
```
```{r, include=FALSE}
#Create new dataframe with Euclidean distances converted to TRAVEL TIME:
#Put together as a dataframe:
eu_table <- data.frame(origin, destination, distance) 
eu_table$distance <- eu_table$distance / 1000 # convert distance (m) to distance km
eu_table$time <- eu_table$distance / 40 # travel time in hours, travelling at a constant speed of 40 km/h
eu_table$time <- eu_table$time*60 #convert to travel time in minutes
eu_table$impedance <- eu_table$time # create impedance (accessibility) column
      eu_table$impedance <- case_when(
    eu_table$impedance <= 5 ~ 0.946,
    eu_table$impedance > 5 & eu_table$impedance <= 10 ~ 0.801,
    eu_table$impedance > 10 & eu_table$impedance <= 15 ~ 0.607,
    eu_table$impedance > 15 & eu_table$impedance <= 20 ~ 0.411,
    eu_table$impedance > 20 & eu_table$impedance <= 30 ~ 0.135,
    eu_table$impedance > 30 & eu_table$impedance <= 45 ~ 0.011,
    eu_table$impedance >= 45 ~ 0
  )
# weighted sum of impedance by DA
sum_impedance <- eu_table %>%
  group_by(origin) %>%
  summarize(total_impedance = sum(impedance))
sum_impedance$DAUID <- DAs$DAUID #adding the DAUID to link census data
DAs$total_impedance <- sum_impedance$total_impedance #adding the values to our DAs (simple features)
```
```{r, include=FALSE}
#----- NETWORK BASED DATA (PAEZ)
# ttm_drive_da was given to us by Dr. Paez, with calculated travel time for each centroid to each clinic
# Calculate impedance; use the formula used by Paez, Higgins, and Vivona (2019). Check equation in page 27.
ttm_drive_da <- ttm_drive_da |>
  mutate(f_tt = case_when(travel_time <= 5 ~ 0.946,
                          travel_time > 5 & travel_time <= 10 ~ 0.801,
                          travel_time > 10 & travel_time <= 15 ~ 0.607,
                          travel_time > 15 & travel_time <= 20 ~ 0.411,
                          travel_time > 20 & travel_time <= 30 ~ 0.135,
                          travel_time > 30 & travel_time <= 45 ~ 0.011,
                          travel_time > 45 ~ 0.000))
#Calculate spatial accessibility by network
acc_sex <- ttm_drive_da |>
  group_by(DAUID) |>
  summarize(acc_sex = sum(f_tt),
            .groups = "drop")
#Obtain summary statistics
summary(acc_sex)
#join acc_sex values into DAs (this has geometry features we can map)
NetworkDAs <- merge(DAs, acc_sex, by = "DAUID", all.x = TRUE) # DAs must be listed first to retain its geometry features

```
  
# Results & Analysis 
  Accessibility is defined in our analysis by the travel time in minutes. The closer the DA centroid is to the clinics, the more accessible it is for those populations. The clinics located in the dissemination areas defined in Toronto (Figure 1) were compared to census data of median income, proportion of female population, indigenous population, single-parent population, and visible minority to draw a conclusion to the question “How does accessibility to sexual health care clinics differ across social demographics in Toronto?”
  Figure 2 displays the Moran's I plot of clinic accessibility by dissemination area and the spatial autocorrelation present. As per the Moran's I test results, the Moran's I statistic is 9.311670e-01. This positive and relatively high value suggests that a non-random spatial pattern is present of similar values. The output is summarised in table 1, and this result is confirmed with the points and slope of the plot seen in Figure 2. The points on the plot are situated near the steep line suggesting a correlation being present for the clinic accessibility by dissemination area as well as less randomness being present in these results. Additionally, with the p-value being such a small value at < 2.2e-16 we are able to reject the null hypothesis with a high degree of confidence as the small p-value correlates to a strong pattern being displayed.
```{r, echo=FALSE}
### Moran's I plot, and Moran's I statistics table
#Morans I
#Creating the localmoran function
library(plotly)
library(spdep)
localmoran.map <- function(p, listw, VAR, by){ # p is a simple features object require(tidyverse)
require(spdep)
require(plotly)
df_msc <- p |>
rename(VAR = as.name(VAR),
key = as.name(by)) |> transmute(key,
VAR,
Z = (VAR - mean(VAR)) / var(VAR),
SMA = lag.listw(listw, Z),
Type = case_when(Z < 0 & SMA < 0 ~ "LL",
Z > 0 & SMA > 0 ~ "HH", TRUE ~ "HL/LH"))
local_I <- localmoran(df_msc$VAR, listw)
colnames(local_I) <- c("Ii", "E.Ii", "Var.Ii", "Z.Ii", "p.val")
df_msc <- left_join(df_msc,
data.frame(key = df_msc$key,
                                 local_I),
                      by = "key")
plot_ly(df_msc) |> add_sf(type = "scatter")
}

## moran plot
NetworkDAs_clean <- NetworkDAs[!is.na(NetworkDAs$acc_sex), ]
NetworkDAs_clean.nb <- poly2nb(pl = NetworkDAs_clean, queen = TRUE)
NetworkDAs_clean.w <- nb2listw(NetworkDAs_clean.nb)
moran.test(NetworkDAs_clean$acc_sex, NetworkDAs_clean.w)
moran.plot(NetworkDAs_clean$acc_sex, NetworkDAs_clean.w)

accessmp <- moran.plot(NetworkDAs_clean$acc_sex, NetworkDAs_clean.w, xlab = "Clinic accessibility by DA", ylab = "Spatially lagged clinic accessibility by DA")

```
  Figure 3 can be used to visually compare trends in demographic variables where sexual health clinics are present. As shown in 3A, it appears that high median income coincides with areas where you can expect a sexual health clinic. 3B suggests that there is more accessibility to clinics for households of single parents, which is indicated by the darker hues near the clinics. On the other hand, the data for Indigenous population and visible minorities vs. clinic locations are a bit more unpredictable. Overall, the plot of Indigenous population and accessibility shows there is more accessibility to clinics in areas of high Indigenous population (Figure 3C). A similar pattern is seen for accessibility and visible minorities. Where there is a large population of visible minorities, there is more accessibility to clinics (Figure 3D). From a visual
observation, it appears that little to no randomness is present in the demographics. In relation to the sexual health clinics, these observations suggest a potential correlation with accessibility, prompting further analysis.
```{r, echo=FALSE}
### 4 demographic data plots
#figure - income
ggplot() +
  geom_sf(data = network_left, aes(fill = Median_income), color = NA) + 
  geom_sf(data = clinics) + # Plot the clinics data
  scale_fill_distiller(palette = "BuGn", direction = 1) +
  labs(fill = "Median income by DA") + 
  theme_minimal()

#figure - indigenous pop
ggplot() +
  geom_sf(data = network_left, aes(fill = Indigenous_pop), color = NA) + 
  geom_sf(data = clinics) + # Plot the clinics data
  scale_fill_distiller(palette = "PuRd", direction = 1) +
  labs(fill = "Indigenous population by DA") + 
  theme_minimal()

#figure - one parent families
ggplot() +
  geom_sf(data = network_left, aes(fill = one_parent_families), color = NA) + 
  geom_sf(data = clinics) + # Plot the clinics data
  scale_fill_distiller(palette = "Purples", direction = 1) +
  labs(fill = "Number of one parent families by DA") + 
  theme_minimal()

#figure - visible minority population
ggplot() +
  geom_sf(data = network_left, aes(fill = Vis_minority_pop), color = NA) + 
  geom_sf(data = clinics) + # Plot the clinics data
  scale_fill_distiller(palette = "Blues", direction = 1) +
  labs(fill = "Visible minority population by DA") + 
  theme_minimal()
```
  Figure 4 shows the location of clinics and scale of accessibility, as a function of stepwise impedance, for each clinic. Accessibility is higher in more central parts of the city, since they can reach more clinics at a lower cost due to less travel time and easier access compared to people who live on the outskirts. Another reason could be due to a higher population in the centre which would mean the need for more clinics. This map can be compared to Figure 3A which shows the median income census data. There is some clustering present in central Toronto as well as towards the south-west of the map which means that high median income households have more accessibility to sexual health clinics than low income areas.
```{r, echo=FALSE}
### Spatial analysis by DA map
ggplot() +
  geom_sf(data = NetworkDAs, aes(fill = acc_sex), color = NA) + # Set fill color based on total_impedance and remove outline
  geom_sf(data = clinics) + # Plot the clinics data
  scale_fill_distiller(palette = "RdYlGn", direction = 1) +
  labs(fill = "Spatial Accessibility by DA") + # Label the color scale
  theme_minimal()
```
  Before being able to statistically determine a relationship in accessibility and census covariates, the pattern of accessibility must first be tested for randomness. If this pattern is determined to be non-random, then the regression model can be used to provide more insight into the relationships between these variables. To test the spatial randomness of the accessibility for each DA, a local Moran’s I analysis was calculated. This is a spatial coefficient that helps determine spatial autocorrelation, and tests the null hypothesis that evaluates the data values for spatial randomness. The null hypothesis for this test is that the spatial pattern is spatially random.
  For this dataset, the Moran’s I statistic is 9.31167e-01 and the p-value of the test is 2.2e-16. As the p-value of this analysis is notably less than 0.05, it can be determined that it is statistically significant and the null hypothesis can be rejected with high confidence. This means that the accessibility to the sexual health clinics in Toronto, Ontario is spatially autocorrelated. As illustrated in Figure 5, a local Moran’s I map highlights where low accessibility values are typically with other low accessibility values, and high accessibility values are typically with other high accessibility values.
```{r, echo=FALSE}
### Local Moran's I map
lmp.pop15plus <- localmoran.map(census_data_clean, census_data_clean.w, "Pop15plus", by = "DAUID")

#Creating the screenshot for knitting
htmlwidgets::saveWidget(widget = lmp.pop15plus,
file = "lmp.pop15plus.html")
webshot2::webshot(url = "lmp.pop15plus.html", file = "lmp.pop15plus.png",
                  delay=1,
                  zoom=4,
                  vheight=500)
```
  Knowing that accessibility to sexual health clinics in Toronto has a non-spatially random pattern, the next step is to determine the process that creates this non-random pattern. Regression analysis can be used to determine the relationships between the census variables and accessibility. Looking at table 2 below, the collinearity for the independent variables show that indigenous and minority population pairing is extremely collinear to analyse and draw accurate conclusions. Similarly, the collinear values for one parent families and visible minorities, and one parent families and indigenous population, are close to 1 which makes us less confident in the comparison of these factors.
```{r, echo=FALSE}
#Table 2. Collinearity values for the independent variables.
cor.test(network_left$Median_income, network_left$Vis_minority_pop)
cor.test(network_left$Median_income, network_left$Indigenous_pop)
cor.test(network_left$Median_income, network_left$one_parent_families)
cor.test(network_left$Indigenous_pop, network_left$Vis_minority_pop)
cor.test(network_left$one_parent_families, network_left$Vis_minority_pop)
cor.test(network_left$one_parent_families, network_left$Indigenous_pop)

```
  Since we found that the Indigenous population and visible minority population statistics were highly correlated (collinear), the decision was made to only use one of these variables for the sake of reducing redundancy. We opted to use the visible minority population because the variable was more generalised and encompassed more representation. Using a multivariate linear regression model, the following output was produced:
```{r, echo=FALSE}
#multivariate linear regression model output (from console)
regressionclean <- network_left[complete.cases(network_left$Vis_minority_pop, network_left$Median_income, network_left$one_parent_families, network_left$acc_sex), ]

predictormodel <- lm(formula = acc_sex ~ Median_income + Vis_minority_pop + one_parent_families, data = regressionclean)
summary(predictormodel)
```
  These results indicate that the relationships between sexual health clinics and median income, visible minority population, and one-parent families are statistically significant. This is proven by the sub 0.05 p-values. These findings coincide with the trends observed in Figure 3:A-D. The next step in the regression analysis was to assess the residual values. These values should indicate randomness in order for the regression model to be well-fitted to our data analysis. The outcome (Figure 5) appeared to be spatially non-random.
```{r, echo=FALSE}
### Figure 6. Local Moran Test Results on Residual Value
regressionclean$predictormodel.e <- predictormodel$residuals

#now we must merge regression clean to have geometry data, with DAs
residualmap <- merge(NetworkDAs, regressionclean, by = "DAUID")

# Recall that 'plot_ly()' is a function used to create interactive plots
plot_ly(regressionclean) |> 
  # Recall that `add_sf()` is similar to `geom_sf()` and it draws a simple features object on a `plotly` plot. This example adds colors to represent positive (blue) and negative residuals (red).
  add_sf(type = "scatter",
         color = ~(predictormodel.e > 0), 
         colors = c("red", 
                    "dodgerblue4")) # this does NOT look random... must test morans I


```
  Figure 6 shows a clear clustering towards the downtown area, indicating non-randomness. To further test this correlation, we looked at the statistics for the Moran’s I test on the residual values:
```{r, echo=FALSE}
#statistics for the Moran’s I test on the residual values (console outputs)
# Here, we use use `poly2nb()` to create a list of neighbors, based on the criterion of adjacency. Next, we pass that list of neighbors to `nb2listw()` to create a set of spatial weights.  
regressionclean.w <- regressionclean |> 
  poly2nb() |>
  nb2listw() 
moran.test(regressionclean$predictormodel.e, 
           regressionclean.w)
```
  The statistical results confirm the residuals are not spatially random shown by the p-value significantly lower than 0.05. In order for a successful linear regression model, the p-values should be high, indicating randomness as spatial autocorrelation can be problematic for linear regression analysis. Randomness in residuals is important for successful linear regression as it indicates that the relationships between independent and dependent variables have been captured by the model. The non-randomness of residuals in this case is likely due to linear regression assumptions not being met, ultimately meaning our attempt to create a linear regression model failed.
  Another alternative to linear regression is creating a model using logistic regression analysis, which is similar, however, the outcome variable is dichotomous or can be variables divided into two categories (Dayton, 1992). In the case of this study, it would show whether each social demographic factor is either accessible or not accessible and which factor would be significantly influential. This was tested in a similar study where they analysed how age, gender, income, and education influences rural end users' acceptance of e-health in Bangladesh (Hossain et al., 2019). To test the accuracy of the logistic regression model, the Hosmer-Lemeshow can test the goodness of fit of the data. Other methods that can be used are principal component analysis, factor analysis, and reliability test (Hossain et al., 2019).
  
# Conclusions & Reccomendations
  This analysis aimed to answer the research question: “How does accessibility to sexual health care clinics differ across social demographics in Toronto?”, by focusing on specific demographics of income, gender, age, and the populations of visible minorities, indigenous people, and single-parent families. The results of this analysis indicate the accessibility of sexual healthcare clinics by dissemination area in Toronto is spatially autocorrelated, representing a non-spatially random pattern. There is greater accessibility in the central and downtown areas,
possibly urged by higher populations in those areas. Within this research, there was an interest in presenting all demographic data as rates since it is best practice to do so, but analysis was limited by the census data. In visual analysis, there are some noted non-random patterns involving accessibility by social demographics, including a greater accessibility to sexual healthcare in areas of higher median income and less access for low income households, as well as some patterning of higher accessibility for single-parent households. Further analysis resulted in the determination that relationships between sexual healthcare clinics and median income, visible minority population, and single-parent families are statistically significant, indicating there is not uniformly equitable access to sexual healthcare as Toronto should be aiming for. Their Sexual Health Clinic program claims to aim to specifically serve vulnerable groups like lower income populations requiring sexual health care, however this analysis proves future directions should work on improving accessibility for lower income areas of Toronto.
  The techniques outlined in this paper should be used as a template workflow, encouraging decision-makers to examine demographic data, emphasising vulnerable groups, when deciding where to put new clinics. Vulnerable groups, or people who require greater access to sexual healthcare include: people with concerns about a sexually transmitted infection and their partners, recent immigrants or refugees, people who share a disproportionate burden of HIV/STIs, people who need access to low cost birth control, people without a valid health card, people who are part of the 2SLGBTQ community, and people involved in sex work. Allowing demographic data to inform location decisions in this way will help ensure equal access across demographics to sexual healthcare services, and may also be applied to similar urban necessities. However, this analysis is not entirely up to date as it used census data from 2019-2021, and may be limited by the lack of recent data, especially in the more recent years since the COVID-19 pandemic. It also only included sexual health clinics run by Toronto Public Health, and does not include independent practitioners.
  
# References 
  City Planning Division. (2024, January 3). About Ward Profiles (25-Ward Model). City of Toronto Open Data Portal. https://open.toronto.ca/dataset/ward-profiles-25-ward-model/
  City Planning Division. (2024, January 31). Ward Profiles. https://www.toronto.ca/city-government/data-research-maps/neighbourhoods-communitie s/ward-profiles/
  Dayton, M. C. (1992). Logistic Regression Analysis. University of Maryland: Department of Measurement, Statistics & Evaluation. https://www.econ.upf.edu/~satorra/dades/M2012LogisticRegressionDayton.pdf
  Hossain, N., Yokota, F., Sultana, N., & Ahmed, A. (2019). Factors Influencing Rural End-Users' Acceptance of e-Health in Developing Countries: A Study on Portable Health Clinic in Bangladesh. Telemedicine and e-Health , 25(3), 221-229. https://doi.org/10.1089/tmj.2018.0039
  MountainMath Software and Analytics, & StatsCan. (2021). CensusMapper API. CensusMapper. https://censusmapper.ca/api/CA21#api_variable
  Olsen, J. R., Cook, P. A., Forster, S., & Phillips-Howard, P. A. (2012). Accessibility of sexual health services in teenage sexual health service users: local area geospatial analysis. Journal of Public Health, 34(3), 438-446. doi: 10.1093/pubmed/fdr120
  Paez, A., Higgins, C. D., & Vivona, S. F. (2019). Demand and level of service inflation in Floating Catchment Area (FCA) methods. PloS one, 14(6): e0218773. https://doi.org/10.1371/journal.pone.0218773
  Salehi, R., Hynie, M., & Flicker, S. (2014). Factors associated with access to sexual health services among teens in Toronto: Does immigration matter?. Journal of Immigrant and Minority Health, 16, 638-645. doi: 10.1007/s10903-013-9961-y
  Shah, T. I., Bell, S., & Wilson, K. (2016). Spatial accessibility to health care services: Identifying under-serviced neighbourhoods in Canadian urban areas. PloS one, 11(12). doi:10.1371/journal.pone.0168208
  StatsCan. (2023, September 29). 2021 Census - Boundary files. Statistics Canada. https://www12.statcan.gc.ca/census-recensement/2021/geo/sip-pis/boundary-limites/inde x2021-eng.cfm?year=21
  Toronto Public Health. (2024, January 14). About Sexual Health Clinic Locations, Hours and Services. City of Toronto Open Data Portal. https://open.toronto.ca/dataset/sexual-health-clinic-locations-hours-and-services/
  Toronto Public Health. (n.d.) Sexual Health Clinics. City of Toronto. https://www.toronto.ca/community-people/health-wellness-care/health-clinics/sexual-heal th-clinics/
  Wang, S., Widener, M., Burchell, A. N., Grace, D., & Gesink, D. (2022). Spatial access to sexual health clinics measured through a novel accessibility score in Toronto, Canada. Sexually Transmitted Diseases, 49(7), 484-489. doi: 10.1097/OLQ.0000000000001637
  Weiner, A. (2010). Geographic Variations in Inequities in Access to Sexual and Reproductive Health Services. Studies in Family Planning, 41(2), 134–138. http://www.jstor.org/stable/25681354
  Wong, J. P., K Chan, K. B., Boi-Doku, R., & McWatt, S. (2012). Risk discourse and sexual stigma: Barriers to STI testing, treatment and care among young heterosexual women in disadvantaged neighbourhoods in Toronto. Canadian Journal of Human Sexuality, 21(2). https://www.researchgate.net/publication/289348845_Risk_discourse_and_sexual_stigma _Barriers_to_STI_testing_treatment_and_care_among_young_heterosexual_women_in_ disadvantaged_neighbourhoods_in_Toronto  
